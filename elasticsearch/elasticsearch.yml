# ============================================================
# Elasticsearch 配置文件
# 云原生日志收集平台 - 生产级性能优化版
# ============================================================

# ------------------------------------------------------------
# 集群配置
# ------------------------------------------------------------
cluster.name: "docker-cluster"
node.name: "es-node-1"

# 节点角色 (单节点模式下包含所有角色)
node.roles: [ master, data, ingest ]

# ------------------------------------------------------------
# 网络配置
# ------------------------------------------------------------
network.host: 0.0.0.0
http.port: 9200
transport.port: 9300

# HTTP 配置优化
http.max_content_length: 100mb
http.compression: true
http.compression_level: 3

# ------------------------------------------------------------
# 发现配置 (单节点模式)
# ------------------------------------------------------------
discovery.type: single-node

# ------------------------------------------------------------
# 安全配置 (开发环境禁用，生产环境需启用)
# ------------------------------------------------------------
xpack.security.enabled: false
xpack.security.enrollment.enabled: false
xpack.security.http.ssl.enabled: false
xpack.security.transport.ssl.enabled: false

# ------------------------------------------------------------
# 内存配置 - 性能关键配置
# ------------------------------------------------------------
# 锁定进程内存，防止swap影响性能
bootstrap.memory_lock: true

# ------------------------------------------------------------
# 集群配置
# ------------------------------------------------------------
# 自动创建索引
action.auto_create_index: true

# 单个节点最大分片数
cluster.max_shards_per_node: 3000

# ------------------------------------------------------------
# 查询优化配置
# ------------------------------------------------------------
# 查询缓存配置
indices.queries.cache.size: 10%

# 字段数据缓存
indices.fielddata.cache.size: 20%

# ------------------------------------------------------------
# 注意：以下设置在 ES 9.x 中已移除或默认启用
# - indices.query.bool.max_clause_count (已弃用)
# - xpack.ilm.enabled (默认启用，无需配置)
# ------------------------------------------------------------

# ------------------------------------------------------------
# 线程池配置 - 提升并发处理能力
# ------------------------------------------------------------
thread_pool.write.queue_size: 1000
thread_pool.search.queue_size: 1000

# ------------------------------------------------------------
# 性能优化配置
# ------------------------------------------------------------
# 索引缓冲区大小 (建议设置为堆内存的10%)
indices.memory.index_buffer_size: 10%

# ------------------------------------------------------------
# 注意：索引级别设置（如 index.refresh_interval, index.merge.*）
# 不能在节点配置中设置，需要通过 Index Templates 或 API 设置
# 示例：
#   curl -X PUT "localhost:9200/_template/default_template" -H 'Content-Type: application/json' -d'
#   {
#     "index_patterns": ["*"],
#     "settings": {
#       "index.refresh_interval": "30s",
#       "index.merge.scheduler.max_thread_count": 1
#     }
#   }'
# ------------------------------------------------------------

# ------------------------------------------------------------
# 数据路径 (由Docker Volume管理)
# ------------------------------------------------------------
path.data: /usr/share/elasticsearch/data
path.logs: /usr/share/elasticsearch/logs
